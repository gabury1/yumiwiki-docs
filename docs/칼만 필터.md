---
title: 칼만 필터
aliases: ["kalman filter", "kalman", "칼만필터", "추정"]
---

# 칼만 필터

> 노이즈가 섞인 측정값에서 실제 값을 추정하는 방식

센서로 측정한 값에는 항상 오차가 있다. [[칼만 필터]]는 이런 부정확한 측정값들을 모아서 실제 값에 가까운 추정값을 계산하는 방법이다. 과거 측정값과 현재 측정값을 적절히 섞어서 더 정확한 값을 만든다.

GPS가 흔들리는 값을 주는데 실제로는 부드럽게 움직이는 것처럼 보이는 건 칼만 필터 덕분이다. 자율주행차, 드론, 로봇이 센서 데이터를 처리할 때 거의 필수로 쓴다.

## 동작 원리

온도계로 방 온도를 재는데 매번 조금씩 다른 값이 나온다고 생각해보자. 22도, 23도, 21.5도... 진짜 온도는 22도 근처일 텐데 정확히 알 수가 없다. 칼만 필터는 이런 상황에서 "지금까지 잰 값들을 보니 대충 22도일 것 같다"고 추정한다.

**예측 단계**: 이전 상태를 보고 "다음엔 이럴 것 같다"고 예측한다. 차가 시속 50km로 달리고 있었으면 1초 후에도 비슷하게 달리고 있을 거라고 본다.

**측정 단계**: 실제로 센서로 측정한다. GPS가 "지금 여기 있다"고 알려준다.

**보정 단계**: 예측값과 측정값을 비교한다. 둘 중 어느 쪽을 더 믿을지 **칼만 이득(Kalman Gain)**으로 결정한다. 센서가 정확하면 측정값 쪽으로, 센서가 부정확하면 예측값 쪽으로 기운다.

**업데이트**: 예측과 측정을 섞어서 새로운 추정값을 만든다. 이게 다음 단계의 기준이 된다.

이 과정을 매 순간 반복한다. 측정할 때마다 조금씩 더 정확해진다.

## 용도

**자율주행차**: GPS, 카메라, 라이다, IMU 센서 데이터를 합쳐서 차의 정확한 위치와 속도를 추정한다. 센서 하나만 믿으면 오차가 크다.

**드론**: 가속도계, 자이로스코프 데이터로 자세를 추정한다. 센서 노이즈가 심한데 칼만 필터로 안정화한다.

**주식 트레이딩**: 가격 움직임을 예측하는 데 쓴다. 노이즈가 많은 데이터에서 추세를 찾는다.

**스마트폰**: GPS 위치가 튀는 걸 부드럽게 만든다. 걷는 속도를 고려해서 말도 안 되는 위치는 무시한다.

측정값에 노이즈가 많고, 대략적인 움직임 모델이 있을 때 유용하다.

## 장단점

**장점**:
- 실시간으로 빠르게 계산 가능하다
- 과거 모든 데이터를 저장할 필요 없다
- 여러 센서 데이터를 자연스럽게 융합한다
- 수학적으로 최적의 추정값을 제공한다(선형 시스템에서)

**단점**:
- 선형 시스템에만 정확하다. 비선형이면 Extended Kalman Filter나 Unscented Kalman Filter 같은 변형이 필요하다
- 시스템 모델을 알아야 한다. 차가 어떻게 움직이는지 수식으로 표현해야 한다
- 노이즈가 가우시안 분포를 따른다고 가정한다. 실제로는 안 그럴 때가 많다
- 초기 설정이 까다롭다. 파라미터를 잘못 주면 성능이 나쁘다

## 생태계

- [[OpenCV]] - cv::KalmanFilter 클래스 제공
- [[ROS|Robot Operating System]] - robot_localization 패키지
- [[MATLAB]] - Kalman Filter 툴박스
- [[Python filterpy]] - 칼만 필터 구현 라이브러리
- [[자율주행]] 플랫폼들에서 위치 추정용으로 사용
- [[드론]] 비행 컨트롤러의 센서 융합

## 기타

Rudolf E. Kálmán이 1960년에 발표했다. 원래는 우주선 궤도를 추정하기 위해 만들어졌다. 아폴로 계획에서 달 착륙선의 항법에 쓰였다.

"칼만 필터는 이해하기 어렵다"는 말이 많다. 수식이 복잡해 보여서 그런데, 핵심은 "예측하고, 측정하고, 둘을 섞는다"가 전부다. 수식을 다 이해 못 해도 라이브러리 갖다 쓰면 된다.

GPS 없이도 실내에서 위치를 추정하려면 칼만 필터가 거의 필수다. WiFi 신호 세기나 가속도계 데이터로 위치를 추정할 때 쓴다.
