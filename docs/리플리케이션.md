---
aliases: [Replication, 복제, DB 복제]
---

# 리플리케이션

> 데이터를 여러 서버에 복제해서 안정성을 높이는 방식

한 서버의 데이터를 다른 서버에 복사해두는 방식이다. 중요한 문서를 여러 곳에 보관하는 것과 같다. 원본이 사라져도 복사본으로 복구할 수 있다.

## 동작 원리

**Master-Slave(Primary-Replica)**:

1. 쓰기는 Master에만
2. Master가 변경 내용을 Slave에 전파
3. 읽기는 Slave에서도 가능
4. Master 장애 시 Slave가 승격

**동기 vs 비동기**:

- 동기: 모든 복제본 확인 후 응답. 안전하지만 느림
- 비동기: 일단 응답, 나중에 복제. 빠르지만 유실 가능

## 용도

DB의 [[가용성]] 확보. Master가 죽어도 Replica로 서비스 유지. 읽기 부하 분산. 재해 복구를 위한 지역 분산.

## 장단점

**장점**: 고가용성, 읽기 성능 향상, 데이터 안전성

**단점**: 복제 지연으로 일관성 문제, 쓰기 성능 향상 안 됨, 운영 복잡도 증가

## 주의점

**복제 지연(Replication Lag)**: 쓰기 직후 Replica에서 읽으면 데이터 없을 수 있음. Read-Your-Writes 패턴 필요.

**스플릿 브레인**: 네트워크 분리 시 여러 Master가 생길 수 있음. 합의 프로토콜 필요.

## 생태계

- [[MySQL Replication]] - 빌트인 복제
- [[PostgreSQL Streaming Replication]]
- [[MongoDB Replica Set]] - 자동 페일오버
- [[Redis Sentinel]] - 복제 + 모니터링

## 기타

데이터베이스 복제는 "속도의 빛" 문제와 싸운다. 서울과 뉴욕 사이 물리적 거리가 있고, 데이터가 빛의 속도로 전파되더라도 최소 수십~수백 밀리초 걸린다. 완벽한 동기 복제는 불가능하고, 어느 정도 지연은 받아들여야 한다.

"Read-Your-Writes" 문제가 흔하다. 사용자가 글을 쓰고 바로 새로고침했는데 자기가 쓴 글이 안 보이는 현상. 쓰기는 Master에, 읽기는 Replica에서 하는데 복제가 밀려서 그렇다. 해결책은 쓰기 직후 읽기는 Master로 보내거나, Replica 지연 확인하고 따라잡을 때까지 기다리는 것.

Instagram은 전 세계에 데이터를 복제하면서도 일관성을 유지한다. 비결은 "사진은 불변(immutable)"이라는 특성. 한번 올린 사진은 안 바뀌니까 복제가 쉽다. 수정이 잦은 데이터는 복제가 훨씬 복잡하다.

"스플릿 브레인(Split Brain)"은 리플리케이션의 악몽이다. 네트워크가 끊겨서 Master가 둘이 되면, 각자 다른 쓰기를 받아서 데이터가 갈라진다. 나중에 합치려면 충돌 해결이 지옥. [[Raft]], [[Paxos]] 같은 합의 알고리즘이 이 문제를 해결한다.
