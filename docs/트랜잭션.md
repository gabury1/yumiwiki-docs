---
title: 트랜잭션
aliases: ["transaction", "acid", "원자성"]
---

# 트랜잭션 (Transaction)

> "완벽하게 다 성공하든지, 아니면 아예 없었던 일이 되든지"

데이터베이스([[DB]])에서 일어나는 **'작업의 단위'**다. 주로 **"실수하면 대참사가 일어나는 일"**을 처리할 때 쓴다. 가장 대표적인 예시가 바로 **은행 계좌 이체**다.

## 왜 필요한가? (은행 이체의 대참사 예시)

내가 친구에게 1만 원을 보낸다고 가정해보자. 내부적으로는 두 단계가 일어난다.
1.  **내 계좌**에서 1만 원이 빠져나간다. (성공)
2.  **친구 계좌**에 1만 원이 들어간다. (**실패!** - 하필 이때 은행 서버가 꺼짐)

트랜잭션이 없다면? 내 돈만 사라지고 친구는 돈을 못 받는 억울한 상황이 생긴다. 트랜잭션은 이런 일이 절대 일어나지 않게 보장해준다.

## ACID: 트랜잭션의 4가지 초능력

트랜잭션이 안전한 이유는 다음의 4가지 성격을 목숨 걸고 지키기 때문이다.

1.  **원자성 (Atomicity - All or Nothing)**
    -   **설명**: 여러 단계의 작업은 하나의 원자처럼 쪼개질 수 없다.
    -   **현실**: 이체 도중에 어디 하나라도 삐끗하면, 방금 했던 모든 일을 취소하고 **'돈 뽑기 전'** 상태로 완벽하게 되돌린다. (**Rollback**)

2.  **일관성 (Consistency - 규칙 준수)**
    -   **설명**: 작업이 끝나도 데이터의 규칙은 깨지지 않는다.
    -   **현실**: 계좌 잔액이 마이너스가 되면 안 된다는 규칙이 있다면, 이체 후에 그 규칙이 어긋나는 작업은 DB가 알아서 거부한다.

3.  **격리성 (Isolation - 남몰래 하기)**
    -   **설명**: 내가 작업 중일 때는 남이 내 정보를 건드리지 못한다.
    -   **현실**: 내가 이체 중일 때, 다른 사람이 내 잔액을 조회하면 아직 1만 원이 빠지기 전의 정확한 금액만 보여준다. 작업이 완전히 끝나기 전까지는 비밀이다.

4.  **지속성 (Durability - 영원히 기록)**
    -   **설명**: 성공적으로 끝났다면 그 결과는 영구적이다.
    -   **현실**: 이체 성공(Commit) 메시지를 받았다면, 바로 다음 순간 시스템이 폭발해도 내 1만 원은 친구 계좌에 안전하게 들어가 있어야 한다.

## 실무 팁: 개발자들이 겪는 현실

### 1. "잠깐만요, 저 작업 중이에요" (Lock)
두 명이 동시에 똑같은 돈을 출금하려 하면 어떻게 될까? 트랜잭션은 데이터를 **잠금(Lock)** 처리한다. 남이 쓰는 동안 나는 줄 서서 기다려야 한다. 이게 너무 길어지면 웹사이트가 버벅거리는 원인이 된다.

### 2. [[Spring Boot]]의 마법 `@Transactional`
코드를 짤 때 "성공하면 확정하고 실패하면 취소해라"라는 로직을 일일이 적기 귀찮다. 현대 백엔드 개발자들은 함수 위에 `@Transactional`이라는 애노테이션 하나만 붙여서 이 모든 복잡한 처리를 프레임워크에 맡긴다.

## 기타

-   **Commit**: "됐어! 실제 장부에 적어!"
-   **Rollback**: "망했어! 다 없던 일로 해!"
-   **데드락(Deadlock)**: "나 네 거 필요해", "나도 네 거 필요해" 하며 서로 데이터를 붙잡고 영원히 기다리는 교착 상태. 프로그래머의 복통 원인 중 하나다.

